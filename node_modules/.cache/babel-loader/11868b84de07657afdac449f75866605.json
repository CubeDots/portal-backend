{"ast":null,"code":"import _regeneratorRuntime from\"/var/www/html/cuengine-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/var/www/html/cuengine-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/var/www/html/cuengine-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import Popover from'react-bootstrap/Popover';//import OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport axios from\"axios\";import Spinner from'react-bootstrap/Spinner';import{useIsAuthenticated}from'react-auth-kit';import BecomeOurPartnerModal from\"../home/BecomeOurPartnerModal\";// const UpdatingPopover = React.forwardRef(\n//   ({ popper, children, show: _, ...props }, ref) => {\n//     useEffect(() => {\n//       console.log('updating!');\n//       popper.scheduleUpdate();\n//     }, [children, popper]);\n//     return (\n//       <Popover ref={ref} body {...props}>\n//         {children}\n//       </Popover>\n//     );\n//   },\n// );\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function PopoverDownloadButton(props){var row=props.row;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),downLoading=_useState2[0],setdownLoading=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),downLoadingPercentage=_useState4[0],setdownLoadingPercentage=_useState4[1];var isAuthenticated=useIsAuthenticated();var getFileDownload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(row){var fileURL,fileNameRename,newFileName,fileName;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setdownLoading(true);console.log(\"row.mime_type \",row.mime_type,row.path,row);fileURL=row.path;console.log(\"fileURL\",fileURL.replace(\" \",\"_\"));fileNameRename=row.name;newFileName=fileNameRename.replace(\" \",\"_\");fileName=newFileName;setdownLoadingPercentage(0);_context.prev=8;_context.next=11;return axios({url:decodeURI(fileURL),method:\"GET\",responseType:\"blob\",// important\nonDownloadProgress:function onDownloadProgress(progressEvent){var progress=Math.round(progressEvent.loaded*100/progressEvent.total);setdownLoadingPercentage(progress);}})// .then(resp => resp.blob())\n.then(function(response){var url=window.URL.createObjectURL(new Blob([response.data]));var link=document.createElement(\"a\");link.href=url;link.setAttribute(\"download\",fileName);//or any other extension\n//or any other extension\ndocument.body.appendChild(link);link.click();window.URL.revokeObjectURL(url);setdownLoading(false);}).catch(function(error){setdownLoading(false);console.log(\"Errors: \",error.message);return[];});case 11:_context.next=18;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](8);console.log(\"error \",_context.t0);setdownLoading(false);alert('File downloading failed.');case 18:case\"end\":return _context.stop();}}},_callee,null,[[8,13]]);}));return function getFileDownload(_x){return _ref.apply(this,arguments);};}();var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isBecomeOurPartnerModalShow=_useState6[0],setIsBecomeOurPartnerModalShow=_useState6[1];var showBecomeOurPartnerModal=function showBecomeOurPartnerModal(){console.log(\"showBecomeOurPartnerModal clicked\");setIsBecomeOurPartnerModalShow(true);};var closeBecomeOurPartnerModalModal=function closeBecomeOurPartnerModalModal(){console.log(\"closeBecomeOurPartnerModalModal trigger\");setIsBecomeOurPartnerModalShow(false);};return/*#__PURE__*/_jsx(_Fragment,{children:isAuthenticated()?/*#__PURE__*/_jsx(_Fragment,{children:downLoading?/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-sm btn-primary align-items-center mb-3\",disabled:true,children:[/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"grow\",size:\"sm\",role:\"status\",\"aria-hidden\":\"true\"}),\" \",downLoadingPercentage?downLoadingPercentage+'%':'',\" Downloading...\"]}):/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-sm btn-primary align-items-center mb-3\",onClick:function onClick(){return getFileDownload(row);},children:[/*#__PURE__*/_jsxs(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"16\",height:\"16\",fill:\"currentColor\",className:\"bi bi-download\",viewBox:\"0 0 16 16\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z\"})]}),\" \",props.children]})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(BecomeOurPartnerModal,{show:isBecomeOurPartnerModalShow,onHide:closeBecomeOurPartnerModalModal}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-sm btn-primary align-items-center mb-3\",onClick:showBecomeOurPartnerModal,children:[/*#__PURE__*/_jsxs(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"16\",height:\"16\",fill:\"currentColor\",className:\"bi bi-download\",viewBox:\"0 0 16 16\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z\"})]}),\" \",props.children]})]})});}export default PopoverDownloadButton;","map":{"version":3,"sources":["/var/www/html/cuengine-portal/src/components/cuverse/PopoverDownloadButton.js"],"names":["React","useEffect","useState","Popover","axios","Spinner","useIsAuthenticated","BecomeOurPartnerModal","PopoverDownloadButton","props","row","downLoading","setdownLoading","downLoadingPercentage","setdownLoadingPercentage","isAuthenticated","getFileDownload","console","log","mime_type","path","fileURL","replace","fileNameRename","name","newFileName","fileName","url","decodeURI","method","responseType","onDownloadProgress","progressEvent","progress","Math","round","loaded","total","then","response","window","URL","createObjectURL","Blob","data","link","document","createElement","href","setAttribute","body","appendChild","click","revokeObjectURL","catch","error","message","alert","isBecomeOurPartnerModalShow","setIsBecomeOurPartnerModalShow","showBecomeOurPartnerModal","closeBecomeOurPartnerModalModal","children"],"mappings":"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","sourcesContent":["\nimport React, { useEffect, useState } from 'react';\nimport Popover from 'react-bootstrap/Popover';\n//import OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport axios from \"axios\";\nimport Spinner from 'react-bootstrap/Spinner';\nimport { useIsAuthenticated } from 'react-auth-kit';\nimport BecomeOurPartnerModal from \"../home/BecomeOurPartnerModal\";\n\n// const UpdatingPopover = React.forwardRef(\n//   ({ popper, children, show: _, ...props }, ref) => {\n//     useEffect(() => {\n//       console.log('updating!');\n//       popper.scheduleUpdate();\n//     }, [children, popper]);\n\n//     return (\n//       <Popover ref={ref} body {...props}>\n//         {children}\n//       </Popover>\n//     );\n//   },\n// );\n\n\nfunction PopoverDownloadButton(props) {\n  const { row } = props;\n  const [downLoading, setdownLoading] = useState(false);\n  const [downLoadingPercentage, setdownLoadingPercentage] = useState(0);\n\n  const isAuthenticated = useIsAuthenticated();\n\n  const getFileDownload = async (row) => {\n    setdownLoading(true);\n    console.log(\"row.mime_type \", row.mime_type, row.path, row);\n    let fileURL = row.path;\n    console.log(\"fileURL\", fileURL.replace(\" \", \"_\"));\n    let fileNameRename = row.name;\n    let newFileName = fileNameRename.replace(\" \", \"_\");\n    let fileName = newFileName;\n    setdownLoadingPercentage(0);\n    try {\n     \n      await axios({\n        url: decodeURI(fileURL),\n        method: \"GET\",\n        responseType: \"blob\", // important\n        onDownloadProgress(progressEvent) {\n          let progress = Math.round((progressEvent.loaded  * 100 ) / progressEvent.total);\n          setdownLoadingPercentage(progress);\n        }\n      })\n        // .then(resp => resp.blob())\n        .then(response => {\n          const url = window.URL.createObjectURL(new Blob([response.data]));\n          const link = document.createElement(\"a\");\n          link.href = url;\n          link.setAttribute(\"download\", fileName); //or any other extension\n          document.body.appendChild(link);\n          link.click();\n          window.URL.revokeObjectURL(url);\n          setdownLoading(false);\n        })\n        .catch(error => {\n          setdownLoading(false);\n          console.log(\"Errors: \", error.message);\n          return [];\n        });\n\n    } catch (error) {\n      console.log(\"error \", error);\n      setdownLoading(false);\n      alert('File downloading failed.')\n    }\n\n    /* fetch(fileURL)\n      .then(resp => resp.blob())\n      .then(blob => {\n        setdownLoading(false);\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.style.display = 'none';\n        a.href = url;\n        // the filename you want\n        a.download = fileName;\n        document.body.appendChild(a);\n        a.click();\n        window.URL.revokeObjectURL(url);\n        // alert('your file has downloaded!'); // or you know, something with better UX...\n      })\n      .catch(() => alert('Download failed.')); \n    */\n\n  };\n  const [isBecomeOurPartnerModalShow, setIsBecomeOurPartnerModalShow] = useState(false);\n  const showBecomeOurPartnerModal = () => {\n    console.log(\"showBecomeOurPartnerModal clicked\");\n    setIsBecomeOurPartnerModalShow(true);\n  }\n\n  const closeBecomeOurPartnerModalModal = () => {\n    console.log(\"closeBecomeOurPartnerModalModal trigger\");\n    setIsBecomeOurPartnerModalShow(false);\n  }\n\n  return (\n    <>\n      {isAuthenticated() ?\n        <>\n          {downLoading ?\n            <button type=\"button\" className=\"btn btn-sm btn-primary align-items-center mb-3\" disabled >\n              <Spinner as=\"span\" animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\" /> {downLoadingPercentage ? downLoadingPercentage+'%' : ''} Downloading...\n            </button>\n            :\n            <button type=\"button\" className=\"btn btn-sm btn-primary align-items-center mb-3\" onClick={() => getFileDownload(row)} >\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" className=\"bi bi-download\" viewBox=\"0 0 16 16\">\n                <path d=\"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z\" />\n                <path d=\"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z\" />\n              </svg> {props.children}\n            </button>\n          }\n        </>\n\n        :\n        <>\n          <BecomeOurPartnerModal show={isBecomeOurPartnerModalShow} onHide={closeBecomeOurPartnerModalModal} />\n          <button type=\"button\" className=\"btn btn-sm btn-primary align-items-center mb-3\" onClick={showBecomeOurPartnerModal}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" className=\"bi bi-download\" viewBox=\"0 0 16 16\">\n              <path d=\"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z\" />\n              <path d=\"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z\" />\n            </svg> {props.children}\n          </button>\n          {/* <OverlayTrigger\n          trigger=\"click\"\n          overlay={<UpdatingPopover id=\"popover-contained\">Login required.</UpdatingPopover>}\n        >\n          <button type=\"button\" className=\"btn btn-sm btn-primary align-items-center mb-3\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" className=\"bi bi-download\" viewBox=\"0 0 16 16\">\n              <path d=\"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z\" />\n              <path d=\"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z\" />\n            </svg> {props.children}\n          </button>\n        </OverlayTrigger> */}\n        </>\n      }\n    </>\n  );\n}\n\nexport default PopoverDownloadButton;"]},"metadata":{},"sourceType":"module"}